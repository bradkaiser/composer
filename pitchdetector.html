<html>
<head>
<title>Pitch Detector</title>
<style>

.chart rect {
    stroke: black;
}

.chart { 
    padding: 10px;
}

.graph-holder { 
    float:left;
    height: 200px;
    width: 50%;
}

.music-holder {
    margin-top: 40px;
    width: 90%;
    height: 1000px;
}

</style>
</head>

<body>
    <h1>Pitch Detector</h1>

    <p>Notes are being printed to console.</p>


    <div id="recordButton">Record Button</div>

    <div id="pcm" class="graph-holder">
        <h2>PCM</h2>
    </div> 
    <div id="fft" class="graph-holder">
        <h2>FFT</h2>
    </div> 

    <div id="music-holder"></div>

</body>

<script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
<script src="js/lib/dsp.js" type="text/javascript"></script>
<script src="js/BarGraph.js" type="text/javascript"></script>
<script src="js/NoteDetector.js" type="text/javascript"></script>
<script src="js/Microphone.js"></script>
<script src="js/jquery-1.10.2.min.js"></script>
<script src="js/vexflow-min.js"></script>
<script src="js/note.js"></script>
<script src="js/bar.js"></script>
<script src="js/raphael.js"></script>
<script src="js/BarManager.js"></script>
<script src="js/BarManager.js"></script>
<script type="text/javascript">

var pcmGraph = new BarGraph('#pcm', .1);
var fftGraph = new BarGraph('#fft', .01);

var el = document.getElementById('recordButton');
var bufferSize = 2048;
var microphone = new ComposerAudio.Microphone(el,bufferSize);
var noteDetector = new ComposerAudio.NoteDetector(bufferSize, 120);

var barManager = new BarManager("music-holder");


el.addEventListener('rawAudio', function(e) { noteDetector.process(e.detail) });
window.addEventListener('noteEvent', function(e) {
    console.log(e.detail) 
    e.detail.forEach( function(noteDetail) {
        var note = new Note(noteDetail.note, noteDetail.octave, noteDetail.type, "" );
        addNoteToStave(note);
    });
});

</script>
</html>
