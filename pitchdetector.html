<html>
<head>
<title>Pitch Detector</title>
<style>

.chart rect {
    stroke: black;
}

.chart { 
    padding: 10px;
}

.graph-holder { 
    float:left;
    height: 200px;
    width: 50%;
}

</style>
</head>

<body>
    <h1>Pitch Detector</h1>

    <p>Notes are being printed to console.</p>


    <div id="recordButton">Record Button</div>

    <div id="pcm" class="graph-holder">
        <h2>PCM</h2>
    </div> 
    <div id="fft" class="graph-holder">
        <h2>FFT</h2>
        <h3>Peak: <span id="peak"></span></h3>
    </div> 

</body>

<script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
<script src="js/lib/dsp.js" type="text/javascript"></script>
<script src="js/BarGraph.js" type="text/javascript"></script>
<script src="js/PitchDetector.js" type="text/javascript"></script>
<script src="js/NoteSnapper.js"></script>
<script src="js/Microphone.js"></script>
<script type="text/javascript">

var pcmGraph = new BarGraph('#pcm', .1);
var fftGraph = new BarGraph('#fft', .01);

var el = document.getElementById('recordButton');
var bufferSize = 2048;
var microphone = new ComposerAudio.Microphone(el,bufferSize);
var pitchDetector = new ComposerAudio.PitchDetector(bufferSize);


el.addEventListener('rawAudio', function(e) { pitchDetector.process(e.detail) });
window.addEventListener('noteEvent', function(e) { console.log(e.detail) });


//needed map for float32Array, this is fastest implmentation, bizarrely.
Float32Array.prototype.evalMap = function(f) {
    var body = f.toString().replace(/function\s*\(x\)\s*\{\s*return /m, '').slice(0, -1);
    var worker = eval('(function (src,dst){ for (var i = 0, l = src.length; i < l; i++) { var x = src[i]; dst[i] = ' + body + '}})');
    var dst = new Float32Array(this.length);
    worker(this, dst);
    return dst;
};


</script>
</html>
