<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>Composer UI</title>

<script src="http://d3lp1msu2r81bx.cloudfront.net/kjs/js/lib/kinetic-v4.7.2.min.js"></script>
<script src="js/jquery-1.10.2.min.js"></script>

<!--
<script src="vexflow-master/src/vex.js"></script>
<script src="vexflow-master/src/flow.js"></script>
<script src="vexflow-master/src/fraction.js"></script>
<script src="vexflow-master/src/tables.js"></script>
<script src="vexflow-master/src/fonts/vexflow_font.js"></script>
<script src="vexflow-master/src/glyph.js"></script>
<script src="vexflow-master/src/stave.js"></script>
<script src="vexflow-master/src/staveconnector.js"></script>
<script src="vexflow-master/src/tabstave.js"></script>
<script src="vexflow-master/src/tickcontext.js"></script>
<script src="vexflow-master/src/tickable.js"></script>
<script src="vexflow-master/src/note.js"></script>
<script src="vexflow-master/src/ghostnote.js"></script>
<script src="vexflow-master/src/notehead.js"></script>
<script src="vexflow-master/src/stem.js"></script>
<script src="vexflow-master/src/stavenote.js"></script>
<script src="vexflow-master/src/tabnote.js"></script>
<script src="vexflow-master/src/beam.js"></script>
<script src="vexflow-master/src/voice.js"></script>
<script src="vexflow-master/src/voicegroup.js"></script>
<script src="vexflow-master/src/modifier.js"></script>
<script src="vexflow-master/src/modifiercontext.js"></script>
<script src="vexflow-master/src/accidental.js"></script>
<script src="vexflow-master/src/dot.js"></script>
<script src="vexflow-master/src/formatter.js"></script>
<script src="vexflow-master/src/stavetie.js"></script>
<script src="vexflow-master/src/tabtie.js"></script>
<script src="vexflow-master/src/tabslide.js"></script>
<script src="vexflow-master/src/bend.js"></script>
<script src="vexflow-master/src/vibrato.js"></script>
<script src="vexflow-master/src/annotation.js"></script>
<script src="vexflow-master/src/articulation.js"></script>
<script src="vexflow-master/src/tuning.js"></script>
<script src="vexflow-master/src/stavemodifier.js"></script>
<script src="vexflow-master/src/keysignature.js"></script>
<script src="vexflow-master/src/timesignature.js"></script>
<script src="vexflow-master/src/clef.js"></script>
<script src="vexflow-master/src/music.js"></script>
<script src="vexflow-master/src/keymanager.js"></script>
<script src="vexflow-master/src/renderer.js"></script>
<script src="vexflow-master/src/raphaelcontext.js"></script>
<script src="vexflow-master/src/stavebarline.js"></script>
<script src="vexflow-master/src/stavehairpin.js"></script>
<script src="vexflow-master/src/stavevolta.js"></script>
<script src="vexflow-master/src/staverepetition.js"></script>
<script src="vexflow-master/src/stavesection.js"></script>
<script src="vexflow-master/src/stavetempo.js"></script>
<script src="vexflow-master/src/barnote.js"></script>
<script src="vexflow-master/src/tremolo.js"></script>
<script src="vexflow-master/src/tuplet.js"></script>
<script src="vexflow-master/src/boundingbox.js"></script>
<script src="vexflow-master/src/textnote.js"></script>
<script src="vexflow-master/src/frethandfinger.js"></script>
<script src="vexflow-master/src/stringnumber.js"></script>
<script src="vexflow-master/src/strokes.js"></script>
-->
<script src="js/vexflow-min.js"></script>

<script src="js/note.js"></script>
<script src="js/bar.js"></script>
<script src="js/raphael.js"></script>
<script src="js/BarManager.js"></script>
<script src="js/MusicManager.js"></script>
<script src="js/MIDI.js"></script>
<script src="js/jasmid/audio.js"></script>
<script src="js/jasmid/midifile.js"></script>
<script src="js/jasmid/replayer.js"></script>
<script src="js/jasmid/stream.js"></script>
<script src="js/jasmid/synth.js"></script>
<script src="js/base64binary.js"></script>
<script src="js/lib/dsp.js" type="text/javascript"></script>
<script src="js/lib/dywapitch.js"></script>
<script src="js/NoteDetector.js" type="text/javascript"></script>
<script src="js/Microphone.js"></script>

<link rel="stylesheet" type="text/css" href="css/main.css">


</head>
<body>

<a href="javascript: playPause()"> 
<div>
Play/Pause 
</div>
</a>

<div id="record-button-holder">
    <div  id="record-button" title="Record">
        <div id="record-button-inner"></div>
    </div>
</div>

<div id="mainDiv" style=" margin:0 auto; width:1100px; height:1000px;">
	<div id="subsidiaryDiv" style="float:right; width:1075px; height:1000px;">
    </div>
</div>


<script>
var $recordButton = $('#record-button');

var bufferSize = 2048;
var bpm = 120;
var microphone = new ComposerAudio.Microphone($recordButton.get(),bufferSize);
var noteDetector = new ComposerAudio.NoteDetector(bufferSize, bpm);

//Create score
BarManager("subsidiaryDiv");

$recordButton.on('click', function(e) {
    e.preventDefault();
    $('#record-button-inner').toggleClass('square');
});
        
$recordButton.on('rawAudio', function(e) { noteDetector.process(e.detail) });
window.addEventListener('noteEvent', function(e) {
    console.log(e.detail) 
    e.detail.forEach( function(noteDetail) {
        var note = new Note(noteDetail.note, noteDetail.octave, noteDetail.type, "" );
        addNoteToStave(note);
    });
});


$(document).ready(function(e){
  $("#subsidiaryDiv").dblclick(function(e){
      var posX = $(this).position().left,
        posY = $(this).position().top;
        highlightNote(e.pageX - posX,e.pageY - posY); 	
  });
});
	
	

	
</script>


</body>
</html>
