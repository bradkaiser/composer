<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>Composer UI</title>

<link href="http://netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet">

<script src="js/lib/jquery-1.10.2.min.js"></script>

<script src="js/lib/raphael.js"></script>

<script src="js/lib/vexflow-master/src/vex.js"></script>
<script src="js/lib/vexflow-master/src/flow.js"></script>
<script src="js/lib/vexflow-master/src/fraction.js"></script>
<script src="js/lib/vexflow-master/src/tables.js"></script>
<script src="js/lib/vexflow-master/src/fonts/vexflow_font.js"></script>
<script src="js/lib/vexflow-master/src/glyph.js"></script>
<script src="js/lib/vexflow-master/src/stave.js"></script>
<script src="js/lib/vexflow-master/src/staveconnector.js"></script>
<script src="js/lib/vexflow-master/src/tabstave.js"></script>
<script src="js/lib/vexflow-master/src/tickcontext.js"></script>
<script src="js/lib/vexflow-master/src/tickable.js"></script>
<script src="js/lib/vexflow-master/src/note.js"></script>
<script src="js/lib/vexflow-master/src/ghostnote.js"></script>
<script src="js/lib/vexflow-master/src/notehead.js"></script>
<script src="js/lib/vexflow-master/src/stem.js"></script>
<script src="js/lib/vexflow-master/src/stavenote.js"></script>
<script src="js/lib/vexflow-master/src/tabnote.js"></script>
<script src="js/lib/vexflow-master/src/beam.js"></script>
<script src="js/lib/vexflow-master/src/voice.js"></script>
<script src="js/lib/vexflow-master/src/voicegroup.js"></script>
<script src="js/lib/vexflow-master/src/modifier.js"></script>
<script src="js/lib/vexflow-master/src/modifiercontext.js"></script>
<script src="js/lib/vexflow-master/src/accidental.js"></script>
<script src="js/lib/vexflow-master/src/dot.js"></script>
<script src="js/lib/vexflow-master/src/formatter.js"></script>
<script src="js/lib/vexflow-master/src/stavetie.js"></script>
<script src="js/lib/vexflow-master/src/tabtie.js"></script>
<script src="js/lib/vexflow-master/src/tabslide.js"></script>
<script src="js/lib/vexflow-master/src/bend.js"></script>
<script src="js/lib/vexflow-master/src/vibrato.js"></script>
<script src="js/lib/vexflow-master/src/annotation.js"></script>
<script src="js/lib/vexflow-master/src/articulation.js"></script>
<script src="js/lib/vexflow-master/src/tuning.js"></script>
<script src="js/lib/vexflow-master/src/stavemodifier.js"></script>
<script src="js/lib/vexflow-master/src/keysignature.js"></script>
<script src="js/lib/vexflow-master/src/timesignature.js"></script>
<script src="js/lib/vexflow-master/src/clef.js"></script>
<script src="js/lib/vexflow-master/src/music.js"></script>
<script src="js/lib/vexflow-master/src/keymanager.js"></script>
<script src="js/lib/vexflow-master/src/renderer.js"></script>
<script src="js/lib/vexflow-master/src/raphaelcontext.js"></script>
<script src="js/lib/vexflow-master/src/stavebarline.js"></script>
<script src="js/lib/vexflow-master/src/stavehairpin.js"></script>
<script src="js/lib/vexflow-master/src/stavevolta.js"></script>
<script src="js/lib/vexflow-master/src/staverepetition.js"></script>
<script src="js/lib/vexflow-master/src/stavesection.js"></script>
<script src="js/lib/vexflow-master/src/stavetempo.js"></script>
<script src="js/lib/vexflow-master/src/barnote.js"></script>
<script src="js/lib/vexflow-master/src/tremolo.js"></script>
<script src="js/lib/vexflow-master/src/tuplet.js"></script>
<script src="js/lib/vexflow-master/src/boundingbox.js"></script>
<script src="js/lib/vexflow-master/src/textnote.js"></script>
<script src="js/lib/vexflow-master/src/frethandfinger.js"></script>
<script src="js/lib/vexflow-master/src/stringnumber.js"></script>
<script src="js/lib/vexflow-master/src/strokes.js"></script>



<script src="js/note.js"></script>
<script src="js/bar.js"></script>
<script src="js/BarManager.js"></script>
<script src="js/MusicManager.js"></script>
<script src="js/lib/MIDI.js"></script>
<script src="js/lib/base64binary.js"></script>
<script src="js/lib/dsp.js" type="text/javascript"></script>
<script src="js/lib/dywapitch.js"></script>
<script src="js/NoteDetector.js" type="text/javascript"></script>
<script src="js/Microphone.js"></script>
<script src="js/popup.js"></script>

<link rel="stylesheet" type="text/css" href="css/main.css">


</head>
<body>


<div id="record-button">
    <i class="fa fa-microphone fa-5x pulse-red" ></i>
</div>

<div id="mainDiv">
    <div id="play-control">
        <i class="fa fa-play fa-2x"></i>
    </div>
    <div id="info">
    	<a href="#" class="topopup"><i class="fa fa-info-circle fa-3x"></i></a>
    </div>	
    <div id="subsidiaryDiv">
    </div>
</div>


<div id="toPopup">

        <div class="close"></div>
		<div id="popup_content"> <!--your content start-->
            <center><h1>Composer</h1></center>
            <p>Composer lets you hum or whistle into your microphone and create vibrant sheet music for you to share with others. We can take simple tunes
            and beats and render them onto one sheet for and allow for easy editing and playback to tune the song to your needs. A brief tutorial will help
            you get started in using this awesome application:</p>
            <h2><strong>Recording</strong></h2>
            <p>Press the <span style="color:#FF4F46">record </span> button to start recording. The percussion and notes can be recorded at the same time. To <span style="color:#FF4F46">record </span> a note hum or whistle your note,
            with a slight pause in between each note for optimal recording. To <span style="color:#FF4F46">record </span> the percussion, tap against a table or something nearby as you would on a drum.
            The rhythm and melody will be recorded simultaneously, although you can alternate between them to make it a bit easier. When you are done recording,
            press the record button again. You can always resume recording anytime. </p>
            <h2><strong>Playback</strong></h2>
            <p>To playback the full composition, press the <span style="color:#33F">play</span> button on the left side of the screen. You can stop the playback at anytime by pressing this button
            again. To <span style="color:#33F">play</span> a specific note, double tap that note and it will be highlighted in a red box. Pressing the <span style="color:#33F">play</span> button now will play the composition starting
            from that note. You can highlight either notes on the treble or percussion clefs and playback will be calculated from that note. At any time, you can also
            press the Enter button to begin playback.</p>
            <h2><strong>Editing</strong></h2>
            <p>You can also edit notes by using the arrow keys and mouse. Highlight a note by first double clicking the note as outlined above. To change the tone
            a half step up, press the up arrow, and to change it a half step down, press the down arrow. To swap notes left and right, use the left and right arrows to
            move the note along the stave. To delete a note, press the backspace key after having highlighted the note.</p>
            <br /><br /> 
        </div> <!--your content end-->

    </div> <!--toPopup end-->

	<div class="loader"></div>
   	<div id="backgroundPopup"></div>


<script>
var $recordButton = $('#record-button');
var recordButton = $('#record-button').get(0); //non jquery version

var $playStopButton = $('#play-control');


var bufferSize = 1024;
var bpm = 120;
var microphone = new ComposerAudio.Microphone(recordButton,bufferSize);
var noteDetector = new ComposerAudio.NoteDetector(bufferSize, bpm);

//Create score
BarManager("subsidiaryDiv");

$recordButton.on('click', function(e) {
        $recordButton.find('i').toggleClass('fa-microphone').toggleClass('fa-microphone-slash');
});

$playStopButton.on('click', function(e) {
	if (allNotes.length > 0 || allPercNotes.length > 0){
		$playStopButton.find('i').toggleClass('fa fa-play fa-2x').toggleClass('fa fa-stop fa-2x');
    	playPause();	
	}
});
        
recordButton.addEventListener('rawAudio', function(e) { 
        noteDetector.process(e.detail) ;
});

recordButton.addEventListener('highpassedAudio', function(e) {
        noteDetector.percussionProcess(e.detail);
});

window.addEventListener('noteEvent', function(e) {
        var noteDetail = e.detail;
        //console.log(noteDetail);
        var note = new Note(noteDetail.note, noteDetail.octave, noteDetail.duration, noteDetail.durationmodifier );
        addNote(note);
});

window.addEventListener('percussionEvent', function(e) {
        addNote(new Note('a',4,4,""), true);
});


$(document).ready(function(e){
  $("#subsidiaryDiv").dblclick(function(e){
      var posX = $(this).position().left,
        posY = $(this).position().top;
        highlightAndPlayNote(e.pageX - posX,e.pageY - posY); 	
  });
});
	
</script>


</body>
</html>
