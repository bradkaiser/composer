<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>Composer UI</title>

<link href="http://netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet">

<script src="js/lib/jquery-1.10.2.min.js"></script>
<script src="js/lib/raphael.js"></script>

<script src="js/lib/vexflow-master/src/vex.js"></script>
<script src="js/lib/vexflow-master/src/flow.js"></script>
<script src="js/lib/vexflow-master/src/fraction.js"></script>
<script src="js/lib/vexflow-master/src/tables.js"></script>
<script src="js/lib/vexflow-master/src/fonts/vexflow_font.js"></script>
<script src="js/lib/vexflow-master/src/glyph.js"></script>
<script src="js/lib/vexflow-master/src/stave.js"></script>
<script src="js/lib/vexflow-master/src/staveconnector.js"></script>
<script src="js/lib/vexflow-master/src/tabstave.js"></script>
<script src="js/lib/vexflow-master/src/tickcontext.js"></script>
<script src="js/lib/vexflow-master/src/tickable.js"></script>
<script src="js/lib/vexflow-master/src/note.js"></script>
<script src="js/lib/vexflow-master/src/ghostnote.js"></script>
<script src="js/lib/vexflow-master/src/notehead.js"></script>
<script src="js/lib/vexflow-master/src/stem.js"></script>
<script src="js/lib/vexflow-master/src/stavenote.js"></script>
<script src="js/lib/vexflow-master/src/tabnote.js"></script>
<script src="js/lib/vexflow-master/src/beam.js"></script>
<script src="js/lib/vexflow-master/src/voice.js"></script>
<script src="js/lib/vexflow-master/src/voicegroup.js"></script>
<script src="js/lib/vexflow-master/src/modifier.js"></script>
<script src="js/lib/vexflow-master/src/modifiercontext.js"></script>
<script src="js/lib/vexflow-master/src/accidental.js"></script>
<script src="js/lib/vexflow-master/src/dot.js"></script>
<script src="js/lib/vexflow-master/src/formatter.js"></script>
<script src="js/lib/vexflow-master/src/stavetie.js"></script>
<script src="js/lib/vexflow-master/src/tabtie.js"></script>
<script src="js/lib/vexflow-master/src/tabslide.js"></script>
<script src="js/lib/vexflow-master/src/bend.js"></script>
<script src="js/lib/vexflow-master/src/vibrato.js"></script>
<script src="js/lib/vexflow-master/src/annotation.js"></script>
<script src="js/lib/vexflow-master/src/articulation.js"></script>
<script src="js/lib/vexflow-master/src/tuning.js"></script>
<script src="js/lib/vexflow-master/src/stavemodifier.js"></script>
<script src="js/lib/vexflow-master/src/keysignature.js"></script>
<script src="js/lib/vexflow-master/src/timesignature.js"></script>
<script src="js/lib/vexflow-master/src/clef.js"></script>
<script src="js/lib/vexflow-master/src/music.js"></script>
<script src="js/lib/vexflow-master/src/keymanager.js"></script>
<script src="js/lib/vexflow-master/src/renderer.js"></script>
<script src="js/lib/vexflow-master/src/raphaelcontext.js"></script>
<script src="js/lib/vexflow-master/src/stavebarline.js"></script>
<script src="js/lib/vexflow-master/src/stavehairpin.js"></script>
<script src="js/lib/vexflow-master/src/stavevolta.js"></script>
<script src="js/lib/vexflow-master/src/staverepetition.js"></script>
<script src="js/lib/vexflow-master/src/stavesection.js"></script>
<script src="js/lib/vexflow-master/src/stavetempo.js"></script>
<script src="js/lib/vexflow-master/src/barnote.js"></script>
<script src="js/lib/vexflow-master/src/tremolo.js"></script>
<script src="js/lib/vexflow-master/src/tuplet.js"></script>
<script src="js/lib/vexflow-master/src/boundingbox.js"></script>
<script src="js/lib/vexflow-master/src/textnote.js"></script>
<script src="js/lib/vexflow-master/src/frethandfinger.js"></script>
<script src="js/lib/vexflow-master/src/stringnumber.js"></script>
<script src="js/lib/vexflow-master/src/strokes.js"></script>



<script src="js/note.js"></script>
<script src="js/bar.js"></script>
<script src="js/BarManager.js"></script>
<script src="js/MusicManager.js"></script>
<script src="js/lib/MIDI.js"></script>
<script src="js/lib/base64binary.js"></script>
<script src="js/lib/dsp.js" type="text/javascript"></script>
<script src="js/lib/dywapitch.js"></script>
<script src="js/NoteDetector.js" type="text/javascript"></script>
<script src="js/Microphone.js"></script>

<link rel="stylesheet" type="text/css" href="css/main.css">


</head>
<body>


<div id="record-button">
    <i class="fa fa-microphone fa-5x pulse-red" ></i>
</div>

<div id="mainDiv">
    <div id="play-control">
        <i class="fa fa-play fa-2x"></i>
    </div>
    <div id="subsidiaryDiv">
    </div>
</div>


<script>
var $recordButton = $('#record-button');
var recordButton = $('#record-button').get(0); //non jquery version

var $playPauseButton = $('#play-control');


var bufferSize = 1024;
var bpm = 120;
var microphone = new ComposerAudio.Microphone(recordButton,bufferSize);
var noteDetector = new ComposerAudio.NoteDetector(bufferSize, bpm);

//Create score
BarManager("subsidiaryDiv");

$recordButton.on('click', function(e) {
        $recordButton.find('i').toggleClass('fa-microphone').toggleClass('fa-microphone-slash');
});

$playPauseButton.on('click', function(e) {
    playPause();
});
        
recordButton.addEventListener('rawAudio', function(e) { 
        noteDetector.process(e.detail) ;
    });

window.addEventListener('noteEvent', function(e) {
    //console.log(e.detail) 
    e.detail.forEach( function(noteDetail) {
        var note = new Note(noteDetail.note, noteDetail.octave, noteDetail.duration, noteDetail.durationmodifier );
        addNote(note);
    });
});


$(document).ready(function(e){
  $("#subsidiaryDiv").dblclick(function(e){
      var posX = $(this).position().left,
        posY = $(this).position().top;
        highlightNote(e.pageX - posX,e.pageY - posY); 	
  });
});
	
	

	
</script>


</body>
</html>
